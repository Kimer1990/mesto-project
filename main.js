(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{cM:()=>L,kW:()=>h,K3:()=>$});var e=Array.from(document.querySelectorAll(".popup")),r=document.querySelector("#full-image-popup"),n=r.querySelector(".popup__full-image"),o=r.querySelector(".popup__image-caption");function c(t){"Escape"===t.key&&a(document.querySelector(".popup_active"))}function a(t){t.classList.remove("popup_active"),document.removeEventListener("keydown",c)}function i(t){t.classList.add("popup_active"),document.addEventListener("keydown",c)}var u,l,s={baseUrl:"https://nomoreparties.co/v1/plus-cohort-10",headers:{authorization:"5e2cb3f4-6b9a-4036-8130-d1685fe9cd93","Content-Type":"application/json"}},d=function(t,e,r){return fetch("".concat(s.baseUrl,"/").concat(t),{method:e,headers:s.headers,body:r}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))},f=document.querySelector(".places__cards"),v=document.querySelector("#card-template").content;function m(t){var e=v.querySelector("li").cloneNode(!0),c=e.querySelector(".card__image"),a=e.querySelector(".card__like"),s=e.querySelector(".card__like-count"),f=t,m=f.owner._id,y=f._id;if(c.setAttribute("src",f.link),c.setAttribute("alt",f.name),e.querySelector(".card__title").textContent=f.name,s.textContent=f.likes.length,function(t,e){S(e)&&p(t)}(a,f),m===h){var _=e.querySelector(".card__delete-icon");_.classList.add("card__delete-icon_active"),_.addEventListener("click",(function(t){i(L),u=t.target,l=y}))}return e.querySelector(".card__like").addEventListener("click",(function(t){S(f)?d("cards/likes/".concat(y),"DELETE").then((function(e){s.textContent=e.likes.length,t.target.classList.remove("card__like_active"),f=e})).catch((function(t){$(t)})):d("cards/likes/".concat(y),"PUT").then((function(e){s.textContent=e.likes.length,p(t.target),f=e})).catch((function(t){$(t)}))})),c.addEventListener("click",(function(t){var e;e=t.target,n.setAttribute("src",e.getAttribute("src")),n.setAttribute("alt",e.getAttribute("alt")),o.textContent=e.getAttribute("alt"),i(r)})),e}function y(t){f.prepend(t)}function p(t){t.classList.add("card__like_active")}function S(t){return t.likes.some((function(t){return t._id===h}))}var _=function(t,e,r){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""};function b(t,e,r){!function(t,e){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(r.inactiveButtonClass),e.disabled=!1):(e.classList.add(r.inactiveButtonClass),e.disabled=!0)}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var h,E={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_inactive",inputErrorClass:"form__field_type_error",errorClass:"form__error_active"},L=document.querySelector("#delete-card-popup"),C=L.querySelector(".form"),g=document.querySelector("#avatar-edit-popup"),k=g.querySelector(".form"),A=k.avatarLink,x=k.querySelector(".form__save-button"),B=document.querySelector("#profile-edit-popup"),w=B.querySelector(".form"),T=w.name,O=w.about,P=w.querySelector(".form__save-button"),j=document.querySelector("#new-card-popup"),D=j.querySelector(".form"),N=D.title,U=D.imageLink,I=D.querySelector(".form__save-button"),J=document.querySelector(".profile"),M=J.querySelector(".profile__title"),G=J.querySelector(".profile__subtitle"),H=J.querySelector(".profile__avatar"),z=J.querySelector(".profile__avatar-mask"),K=J.querySelector(".profile__edit-button"),W=J.querySelector(".profile__add-button");function $(t){console.log(t)}function F(){T.value=M.textContent,O.value=G.textContent,N.value="",U.value="",A.value="",Array.from(document.querySelectorAll(E.formSelector)).forEach((function(t){Array.from(t.querySelectorAll(E.inputSelector)).forEach((function(e){_(t,e,E)}))}))}function Q(t,e){e.textContent=t?"Сохранение...":"Сохранить"}C.addEventListener("submit",(function(t){var e;t.preventDefault(),e=u,d("cards/".concat(l),"DELETE").then((function(){e.closest("li").remove(),hidePopup(L)})).catch((function(t){$(t)}))})),z.addEventListener("click",(function(){i(g),k.querySelector(E.submitButtonSelector).classList.add(E.inactiveButtonClass),k.querySelector(E.submitButtonSelector).disabled=!0,F()})),k.addEventListener("submit",(function(t){t.preventDefault(),Q(!0,x);var e=JSON.stringify({avatar:A.value});d("users/me/avatar","PATCH",e).then((function(t){H.setAttribute("src",t.avatar),a(g)})).catch((function(t){$(t)})).finally((function(){Q(!1,x)}))})),K.addEventListener("click",(function(){i(B),w.querySelector(E.submitButtonSelector).classList.remove(E.inactiveButtonClass),w.querySelector(E.submitButtonSelector).disabled=!1,F()})),w.addEventListener("submit",(function(t){t.preventDefault(),Q(!0,P);var e=JSON.stringify({name:T.value,about:O.value});d("users/me","PATCH",e).then((function(t){M.textContent=t.name,G.textContent=t.about,a(B)})).catch((function(t){$(t)})).finally((function(){Q(!1,P)}))})),W.addEventListener("click",(function(){i(j),D.querySelector(E.submitButtonSelector).classList.add(E.inactiveButtonClass),D.querySelector(E.submitButtonSelector).disabled=!0,F()})),D.addEventListener("submit",(function(t){t.preventDefault(),Q(!0,I);var e=JSON.stringify({name:N.value,link:U.value});d("cards ","POST",e).then((function(t){y(m(t)),a(j)})).catch((function(t){$(t)})).finally((function(){Q(!1,I)}))})),Promise.all([d("users/me","GET"),d("cards","GET")]).then((function(t){var e,r,n,o=(n=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,c=[],a=!0,i=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(c.push(n.value),!e||c.length!==e);a=!0);}catch(t){i=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return c}}(r,n)||function(t,e){if(t){if("string"==typeof t)return q(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(t,e):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];e=c,M.textContent=e.name,G.textContent=e.about,H.setAttribute("src",e.avatar),h=e._id,a.forEach((function(t){y(m(t))}))})).catch((function(t){$(t)})),F(),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);b(r,n,e),r.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,r){e.validity.valid?_(t,e,r):function(t,e,r,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(t,e,e.validationMessage,r)}(t,o,e),b(r,n,e)}))}))}(e,t)}))}(E),e.forEach((function(t){var e=t.querySelector(".popup__close-button");t.addEventListener("mousedown",(function(r){r.target!==t&&r.target!==e||a(t)}))}))})();